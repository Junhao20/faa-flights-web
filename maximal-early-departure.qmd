---
title: "How is the overall on-time departure performance in the US? AND WHY?"
jupyter: sql_final_web
format:
  html:
    code-fold: true
---
```{python}
import pandas as pd
import matplotlib.pyplot as plt

q1 = pd.read_csv("data/q1_maxdelay_air.csv")
q2 = pd.read_csv("data/q2_max_early_departure_minutes.csv")

# clean the data as necessary
q1 = q1[q1["Reporting_Airline"] != "Reporting_Airline"].copy()
q1["max_delay"] = q1["max_delay"].astype(int)
q2 = q2[q2["Reporting_Airline"] != "Reporting_Airline"].copy()
q2.rename(columns={"max_early_departure_minutes": "max_early"}, inplace=True)
q2["max_early"] = q2["max_early"].astype(int)

merged = pd.merge(q1, q2, on="Reporting_Airline", how="inner")
merged = merged.sort_values("max_delay", ascending=True)

airlines   = merged["Reporting_Airline"]
max_delay  = merged["max_delay"]
max_early  = merged["max_early"]

early_neg = -max_early
max_val = max(max_delay.max(), max_early.max())
xlim = max_val * 1.1
plt.rcParams.update({
    "figure.figsize": (7, 5),
    "font.size": 11,
    "axes.grid": True,
    "grid.linestyle": "--",
    "grid.alpha": 0.3,
    "figure.dpi": 120,
})
fig, ax = plt.subplots()
ax.barh(airlines, early_neg,  color="#1f77b4", label="Maximum early departure")
ax.barh(airlines, max_delay, color="#d62728", label="Maximum late departure")
ax.axvline(0, color="black", linewidth=1)
ax.set_xlim(-xlim, xlim)
ax.set_xlabel("Extreme departure minutes (early to the left, late to the right)")
ax.set_ylabel("Airline")
ax.set_title("Airline extremes: earliest and latest departures")
xticks = ax.get_xticks()
ax.set_xticklabels([f"{abs(int(x))}" for x in xticks])
for y, e, d in zip(airlines, early_neg, max_delay):
    # early (left)
    ax.text(e - xlim*0.02, y, f"{abs(e):.0f}", va="center", ha="right", fontsize=8)
    # late (right)
    ax.text(d + xlim*0.02, y, f"{d:.0f}", va="center", ha="left", fontsize=8)

ax.legend(loc="lower right", frameon=False)

plt.tight_layout()
plt.show()
```

From the chart above, it is not hard to see that the early departure is far less than the delays. So far, the Alaska airlines has the best record for early departures. 

From this plot it feels like the story is not just about which airline has the single worst delay, but about how extreme and rare these events are. Some carriers show very long late departures, over three thousand minutes, which is more than two days, so that probably comes from very unusual events like major storms, mechanical problems, or schedule changes. A next step could compare these extremes to the typical delay for each airline, using averages or medians, to see whether a big spike is just one bad day or part of a larger pattern. It would also be interesting to check how many flights for each airline leave very early or very late, maybe by counting the share of departures that are more than one hour off the schedule. Another idea is to break the same analysis by airport or by region, to see whether some hubs create these extreme values more often than others. Looking at those extra views would make the chart less about one dramatic number and more about how each airline usually treats passengers.